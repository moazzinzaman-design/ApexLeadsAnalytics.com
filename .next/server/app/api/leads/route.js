"use strict";(()=>{var e={};e.id=350,e.ids=[350],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5899:(e,s,t)=>{t.r(s),t.d(s,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>_,routeModule:()=>m,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var r={};t.r(r),t.d(r,{GET:()=>d,POST:()=>l,PUT:()=>p});var a=t(9303),n=t(8716),o=t(3131),i=t(7070),c=t(7857);let u=()=>{let e=process.env.SUPABASE_SERVICE_ROLE_KEY||"sb_publishable_Adfac8wgmTp4BxgmTNMeQA_-wsNfEOu";return(0,c.eI)("https://rrckuurbdpdpvylaigvs.supabase.co",e)};async function l(e){try{let s=await e.json(),t=["pro_id","client_name","client_email","client_phone","service_type"].filter(e=>!s[e]);if(t.length>0)return i.NextResponse.json({success:!1,error:`Missing required fields: ${t.join(", ")}`},{status:400});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.client_email))return i.NextResponse.json({success:!1,error:"Invalid email format"},{status:400});let r=s.client_phone.replace(/\s/g,"");if(!/^(\+44|0)[1-9]\d{8,10}$/.test(r))return i.NextResponse.json({success:!1,error:"Invalid UK phone number format"},{status:400});let a=null;try{let e=u(),{data:t,error:r}=await e.from("leads").insert({assigned_pro_id:s.pro_id,client_name:s.client_name,client_email:s.client_email,client_phone:s.client_phone,service_type:s.service_type,message:s.message||null,urgency:s.urgency||"medium",postcode:s.postcode||null,city:s.city||null,status:"new"}).select().single();r?console.error("Supabase insert error:",r):a=t}catch(e){console.error("Supabase connection error:",e)}let n=a?.id||`lead_${Date.now()}_${Math.random().toString(36).substring(7)}`;return console.log("Lead created:",{id:n,pro_id:s.pro_id,client:{name:s.client_name,email:s.client_email,phone:s.client_phone},service:s.service_type,message:s.message,urgency:s.urgency}),i.NextResponse.json({success:!0,data:{id:n,status:"new",message:"Lead submitted successfully"},message:"Your request has been sent! The professional will contact you shortly."})}catch(e){return console.error("Lead submission error:",e),i.NextResponse.json({success:!1,error:"Failed to submit lead. Please try again."},{status:500})}}async function d(e){try{let{searchParams:s}=new URL(e.url),t=s.get("pro_id"),r=s.get("status");if(!t)return i.NextResponse.json({success:!1,error:"Professional ID is required"},{status:400});let a=[],n=0;try{let e=u().from("leads").select("*",{count:"exact"}).eq("assigned_pro_id",t).order("created_at",{ascending:!1});r&&(e=e.eq("status",r));let{data:s,count:o,error:i}=await e;i?console.error("Supabase query error:",i):(a=s||[],n=o||0)}catch(e){console.error("Supabase connection error:",e)}return i.NextResponse.json({success:!0,data:a,total_count:n})}catch(e){return console.error("Fetch leads error:",e),i.NextResponse.json({success:!1,error:"Failed to fetch leads"},{status:500})}}async function p(e){try{let{lead_id:s,status:t}=await e.json();if(!s||!t)return i.NextResponse.json({success:!1,error:"Lead ID and status are required"},{status:400});if(!["new","contacted","quoted","booked","completed","lost"].includes(t))return i.NextResponse.json({success:!1,error:"Invalid status value"},{status:400});let r=null;try{let e=u(),{data:a,error:n}=await e.from("leads").update({status:t,updated_at:new Date().toISOString()}).eq("id",s).select().single();n?console.error("Supabase update error:",n):r=a}catch(e){console.error("Supabase connection error:",e)}return i.NextResponse.json({success:!0,data:{id:s,status:t,...r},message:"Lead status updated successfully"})}catch(e){return console.error("Update lead error:",e),i.NextResponse.json({success:!1,error:"Failed to update lead"},{status:500})}}let m=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/leads/route",pathname:"/api/leads",filename:"route",bundlePath:"app/api/leads/route"},resolvedPagePath:"/Users/moazzinzaman/Desktop/CODING AI/Apex Leads Analytics/app/api/leads/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:g,serverHooks:h}=m,y="/api/leads/route";function f(){return(0,o.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[948,564],()=>t(5899));module.exports=r})();